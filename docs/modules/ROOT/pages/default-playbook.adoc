= Default Playbook Reference

The RegiS Default Playbook is the standard security and governance profile used by `regis-cli`. It provides a comprehensive set of checks to ensure container images meet baseline security requirements and follow best practices.

== Compliance Levels

The playbook categorizes its security checks into two main levels: **Mandatory** and **Recommended**.

=== Mandatory Requirements (Critical)

These are non-negotiable security requirements. Failing any of these checks marks the image as non-compliant.

[cols="1,3,2"]
|===
| Rule | Description | Logic (JSON Logic)

| **No Root**
| The image must not be configured to run as the `root` user.
| `{"!=": [{"var": "results.skopeo.platforms.0.user"}, "root"]}`

| **No Critical**
| No vulnerabilities with a `CRITICAL` severity level found by Trivy.
| `{"==": [{"var": "results.trivy.critical_count"}, 0]}`

| **Trusted Domain**
| The image must originate from a trusted container registry (e.g., Docker Hub, Quay, GHCR).
| `{"in": [{"var": "request.registry"}, ["docker.io", "quay.io", "ghcr.io"]]}`
|===

=== Recommended Requirements (Warning)

These rules represent security best practices. Failing these checks provides a warning but may not block promotion depending on your policy.

[cols="1,3,2"]
|===
| Rule | Description | Logic (JSON Logic)

| **No High**
| No vulnerabilities with a `HIGH` severity level found by Trivy.
| `{"==": [{"var": "results.trivy.high_count"}, 0]}`

| **Freshness**
| The image should have been built or updated within the last 30 days.
| `{"<": [{"var": "results.freshness.age_days"}, 30]}`
|===

== Report Organization

The default playbook structures its findings into seven specialized pages to provide a clear and actionable overview.

[cols="1,3"]
|===
| Page | Purpose

| **Overview** (`index`)
| High-level summary of analysis results, creation time, and "GO/NOGO" recommendation.
| **Compliance** (`compliance`)
| Detailed breakdown of mandatory and recommended scorecard results.
| **Security** (`security`)
| Deep dive into vulnerabilities (Trivy) and image provenance.
| **Supply Chain** (`supply-chain`)
| Analysis of the Software Bill of Materials (SBOM) and OpenSSF Scorecard results.
| **Best Practices** (`best-practices`)
| Insights from Dockerfile linting (Hadolint) and configuration checks.
| **Insights** (`insights`)
| Trends in image freshness, registry popularity, and lifecycle (EndOfLife) status.
| **Technical Details** (`metadata`)
| Low-level data including image layers, Skopeo inspection results, and versioning patterns.
|===

== Standard Metadata

The default playbook automatically consumes "well-known" metadata fields if provided via the `--meta` flag:

*   **`trigger.user`**: Displayed as the initiator of the analysis.
*   **`trigger.url`**: Used to provide a direct link to the CI job or environment that triggered the analysis.

== Analysis Case Studies

These examples demonstrate how `regis-cli` adapts its recommendations based on the security posture and lifecycle of different container images.

=== Case 1: The "Gold Standard" (Compliant)
**Target:** `alpine:latest` (or a specialized minimal base image)

[cols="1,3"]
|===
| Aspect | Status

| **Verdict** | **GO**
| **Compliance** | 100%
| **Security** | 0 Critical, 0 High vulnerabilities.
| **Findings** | Image is lightweight, runs as a non-root user (if configured), and uses a trusted registry. View the link:{attachmentsdir}/examples/alpine/index.html[Live Security Report].
|===

****
**Why it passes:** Minimal images significantly reduce the attack surface. By maintaining zero high-severity vulnerabilities and a small footprint, they represent the ideal state for production deployments.
****

=== Case 2: The "At-Risk" Image (Vulnerable)
**Target:** `old-web-app:v1` (High-vulnerability legacy image)

[cols="1,3"]
|===
| Aspect | Status

| **Verdict** | **NOGO**
| **Compliance** | 45%
| **Security** | 12 Critical, 45 High vulnerabilities.
| **Findings** | Heavy base image (e.g., full Ubuntu/Debian), running as `root`, and containing multiple unpatched security flaws.
|===

> [!CAUTION]
> This image fails the **Mandatory Requirements** and should be blocked from reaching production environments until the base image is updated and security patches are applied.

=== Case 3: The "Legacy" Image (Outdated)
**Target:** `stable-api:v2.4` (Secure but unmaintained)

[cols="1,3"]
|===
| Aspect | Status

| **Verdict** | **GO (with Warnings)**
| **Compliance** | 85%
| **Security** | 0 Critical, 5 High vulnerabilities.
| **Findings** | No critical flaws, but the image is >180 days old and the underlying OS version is nearing its **End of Life (EOL)**.
|===

****
**Insight:** Even if an image is currently "secure" at the vulnerability level, lifecycle checks flag it as a maintenance risk. The playbook recommends a rebuild to ensure continued support and freshness.
****

=== Benchmark: `regis-cli`

Finally, we analyze link:https://github.com/trivoallan/regis-cli[regis-cli] itself. As a tool designed to enforce security, its own image is built following all the "Gold Standard" practices: minimal base image, no vulnerabilities, and full provenance.

[TIP]
====
You can view the live result of this analysis here:
link:{attachmentsdir}/examples/regis-cli-0.5/index.html[**Live `regis-cli:0.5` Benchmark Report**]
====
*   **100% Mandatory Compliance**: Passes all critical checks (No Root, No Critical, Trusted Registry).
*   **Minimal Attack Surface**: Built on a slim Python/Alpine base.
*   **Full Supply Chain Evidence**: Provides both SBOM (CycloneDX) and Provenance indicators.
*   **Active Maintenance**: Regularly rebuilt to maintain a "Fresh" status (< 30 days).

[TIP]
====
For more information on how to define your own compliance rules, see the xref:playbooks.adoc[Understand Playbooks] guide.
====
