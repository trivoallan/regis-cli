{% import theme ~ "/macros.html" as m with context %}
{% set data = report.results.get('hadolint', {}) %}
{% set options = w.options | default({}) %}
{% set limit = options.get('limit', 50) %}

{% if data and not data.error %}
    {% if data.issues %}
        <div class="overflow-auto">
            <table class="striped">
                <thead>
                    <tr>
                        <th>Level</th>
                        <th>Code</th>
                        <th>Line</th>
                        <th>Message</th>
                    </tr>
                </thead>
                <tbody>
                    {% for issue in data.issues[:limit] %}
                    <tr>
                        <td>
                            {% if issue.level == 'error' %}
                                <span class="badge danger">Error</span>
                            {% elif issue.level == 'warning' %}
                                <span class="badge warning">Warning</span>
                            {% elif issue.level == 'info' %}
                                <span class="badge info">Info</span>
                            {% else %}
                                <span class="badge neutral">{{ issue.level | title }}</span>
                            {% endif %}
                        </td>
                        <td><code>{{ issue.code }}</code></td>
                        <td>{% if issue.line %}{{ issue.line }}{% else %}-{% endif %}</td>
                        <td>{{ issue.message }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% if data.issues|length > limit %}
            <p><small>… showing top {{ limit }} of {{ data.issues|length }} issues.</small></p>
        {% endif %}
    {% else %}
        <p>No issues found. Target adheres to Dockerfile best practices.</p>
    {% endif %}

    {% if data.dockerfile %}
    <details>
        <summary>Reconstructed Dockerfile</summary>
        <pre><code style="font-size: 0.85rem;">{{ data.dockerfile }}</code></pre>
    </details>
    {% endif %}
{% elif data.error %}
    <p>⚠️ Hadolint Error: {{ data.error }}</p>
{% endif %}
