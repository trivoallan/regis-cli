{% macro score_color(score, max_score=10) %}
{%- if score is none -%}
#6b7280
{%- else -%}
{%- set ratio = score / max_score -%}
{%- if ratio >= 0.7 -%}
#22c55e
{%- elif ratio >= 0.4 -%}
#f59e0b
{%- else -%}
#ef4444
{%- endif -%}
{%- endif -%}
{% endmacro %}

{% macro badge(label, value, color="#6366f1") %}
<span class="badge" style="--accent-color: {{ color }}; background: var(--accent-color)22; color: var(--accent-color); border: 1px solid var(--accent-color)44;">
    {{ label|e }}: {{ value|e }}
</span>
{% endmacro %}

{% macro bool_icon(val) %}
{%- if val is sameas true -%}
‚úÖ
{%- elif val is sameas false -%}
‚ùå
{%- else -%}
‚ûñ
{%- endif -%}
{% endmacro %}

{% macro section(title, icon="üì¶") %}
<details class="report-section" open>
    <summary>{{ icon }} {{ title|e }}</summary>
    <div class="section-content">
        {{ caller() }}
    </div>
</details>
{% endmacro %}

{% macro table(headers, rows) %}
<table>
    <thead>
        <tr>
            {% for h in headers %}
            <th>{{ h|e }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for row in rows %}
        <tr>
            {% for cell in row %}
            <td>{{ cell }}</td>
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endmacro %}

{% macro score_bar(score, max_score=10) %}
{% set pct = (score / max_score * 100)|round(0)|int %}
{% set pct = 100 if pct > 100 else (0 if pct < 0 else pct) %}
{% set color = score_color(score, max_score)|trim %}
<div class="score-bar-container" style="--accent-color: {{ color }};">
    <div class="score-bar-bg">
        <div class="score-bar-fill" style="width:{{ pct }}%; background: var(--accent-color);"></div>
    </div>
    <span class="score-value" style="color: var(--accent-color);">{{ score }}</span>
</div>
{% endmacro %}
{% macro error_card(name, error) %}
<div class="card error-card" style="border-left: 4px solid #ef4444;">
    <h3 class="card-title" style="color: #ef4444;">‚ö†Ô∏è {{ name|e }} Analyzer Error</h3>
    <div class="error-details">
        <p><strong>Type:</strong> {{ error.type|e }}</p>
        <p><strong>Message:</strong> {{ error.message|e }}</p>
    </div>
</div>
{% endmacro %}
