{% macro badge(label, value=None, status=None, href=None) %}
{%- if href -%}<a href="{{ href }}" style="text-decoration: none; color: inherit;">{%- endif -%}
<span class="badge {% if status %}{{ status }}{% endif %}">
    {{ label|e }}{% if value is not none %}: {{ value|e }}{% endif %}
</span>
{%- if href -%}</a>{%- endif -%}
{% endmacro %}

{% macro bool_icon(val) %}
{%- if val is sameas true -%}
<span class="status-passed">✅</span>
{%- elif val is sameas false -%}
<span class="status-failed">❌</span>
{%- else -%}
<span class="status-muted">➖</span>
{%- endif -%}
{% endmacro %}

{% macro section(title, icon=None) %}
<article>
    <header>
        <h3 style="margin: 0;">{% if icon %}{{ icon }} {% endif %}{{ title|e }}</h3>
    </header>
    {{ caller() }}
</article>
{% endmacro %}

{% macro error_card(name, error) %}
<article style="border-left: 5px solid #ef4444;">
    <header>
        <h3 style="color: #ef4444; margin: 0;">⚠️ {{ name|e }} Analyzer Error</h3>
    </header>
    <p><strong>{{ error.type|e }}:</strong> {{ error.message|e }}</p>
</article>
{% endmacro %}

{% macro render_metadata_rows(data, level=0) %}
    {% for key, value in data.items()|sort %}
        <tr>
            <td style="padding-left: {{ level * 20 }}px;">
                {% if value is mapping %}
                    <strong>{{ key | e }}</strong>
                {% else %}
                    {{ key | e }}
                {% endif %}
            </td>
            <td>
                {% if value is mapping %}
                    {# Recursive call for nested dictionaries #}
                {% else %}
                    {{ value | e }}
                {% endif %}
            </td>
        </tr>
        {% if value is mapping %}
            {{ render_metadata_rows(value, level + 1) }}
        {% endif %}
    {% endfor %}
{% endmacro %}
