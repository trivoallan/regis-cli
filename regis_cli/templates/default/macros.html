{% macro score_color(score, max_score=10) %}
{%- if score is none -%}
#6b7280
{%- else -%}
{%- set ratio = score / max_score -%}
{%- if ratio >= 0.7 -%}
#22c55e
{%- elif ratio >= 0.4 -%}
#f59e0b
{%- else -%}
#ef4444
{%- endif -%}
{%- endif -%}
{% endmacro %}

{% macro badge(label, value, color="#6366f1") %}
<span class="badge" style="background:{{ color }}22;color:{{ color }};border:1px solid {{ color }}44;">
    {{ label|e }}: {{ value|e }}
</span>
{% endmacro %}

{% macro bool_icon(val) %}
{%- if val is sameas true -%}
‚úÖ
{%- elif val is sameas false -%}
‚ùå
{%- else -%}
‚ûñ
{%- endif -%}
{% endmacro %}

{% macro section(title, icon="üì¶") %}
<details class="report-section" open>
    <summary>{{ icon }} {{ title|e }}</summary>
    <div class="section-content">
        {{ caller() }}
    </div>
</details>
{% endmacro %}

{% macro table(headers, rows) %}
<table>
    <thead>
        <tr>
            {% for h in headers %}
            <th>{{ h|e }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for row in rows %}
        <tr>
            {% for cell in row %}
            <td>{{ cell }}</td>
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endmacro %}

{% macro score_bar(score, max_score=10) %}
{% set pct = (score / max_score * 100)|round(0)|int %}
{% set pct = 100 if pct > 100 else (0 if pct < 0 else pct) %}
{% set color = score_color(score, max_score)|trim %}
<div class="score-bar-container">
    <div class="score-bar-bg">
        <div class="score-bar-fill" style="width:{{ pct }}%;background:{{ color }};"></div>
    </div>
    <span class="score-value" style="color:{{ color }};">{{ score }}</span>
</div>
{% endmacro %}
