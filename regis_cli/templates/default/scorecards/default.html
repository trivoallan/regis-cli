{% import theme ~ "/macros.html" as m %}

{# Scorecard result visualization #}
{% set sc_val = sc|default(report.scorecard) %}
{% if sc_val %}
    {% set sc = sc_val %}
    {% set level = sc.level|default('none') %}
    {% set colors = {'gold': '#f59e0b', 'silver': '#94a3b8', 'bronze': '#cd7f32', 'none': '#6b7280'} %}
    {% set icons = {'gold': 'ü•á', 'silver': 'ü•à', 'bronze': 'ü•â', 'none': '‚Äî'} %}
    {% set color = colors[level] %}
    {% set icon = icons[level] %}
    {% set score_pct = sc.score|default(0) %}

    <div class="sc-container" style="--accent-color: {{ color }};">
        <div class="sc-header">
            <h2>üìä {{ sc.scorecard_name|default("Scorecard")|e }}</h2>
        </div>
        
        <div class="sc-metrics">
            <div class="sc-icon">{{ icon }}</div>
            <div>
                <div class="sc-level-name">{{ level|e }}</div>
                <div class="text-muted">
                    {{ sc.passed_rules }}/{{ sc.total_rules }} rules passed ¬∑ {{ score_pct }}%
                </div>
            </div>
        </div>
        
        {{ m.score_bar(score_pct, 100) }}

        <div style="margin-top:20px;">
            <table class="sc-table">
                <thead>
                    <tr>
                        <th class="status">Status</th>
                        <th class="level">Level</th>
                        <th class="rule">Rule</th>
                        <th class="analyzers">Analyzers</th>
                        <th class="tags">Tags</th>
                        <th class="details">Details</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in sc.rules %}
                        {% set lvl = r.level|default('') %}
                        {% set lvl_icon = icons.get(lvl, '') %}
                        <tr>
                            <td class="status">
                                {% if r.status == "incomplete" %}
                                    <span title="Incomplete data">‚ö†Ô∏è</span>
                                {% elif r.passed %}
                                    ‚úÖ
                                {% else %}
                                    ‚ùå
                                {% endif %}
                            </td>
                            <td class="level">
                                {{ lvl_icon }} {{ lvl|e }}
                            </td>
                            <td class="rule">
                                <div class="rule-title">{{ r.title|default(r.name)|default('')|e }}</div>
                            </td>
                            <td class="analyzers">
                                {% if r.analyzers %}
                                    <div class="sc-tag-list">
                                        {% for analyzer in r.analyzers %}
                                            <span class="sc-tag analyzer-tag" style="background-color: #f3f4f6; color: #374151; font-weight: 500;">
                                                üîç {{ analyzer|e }}
                                            </span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </td>
                            <td class="tags">
                                {% if r.tags %}
                                    <div class="sc-tag-list">
                                        {% for tag in r.tags %}
                                            <span class="sc-tag">
                                                {{ tag|e }}
                                            </span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </td>
                            <td class="details">
                                {{ r.details|e }}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endif %}
