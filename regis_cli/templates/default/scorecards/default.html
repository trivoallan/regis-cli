{% import theme ~ "/macros.html" as m %}

{# Scorecard result visualization #}
{% set sc_val = sc|default(report.scorecard) %}
{% if sc_val %}
    {% set sc = sc_val %}
    {% set level = sc.level|default('none') %}
    {% set colors = {'gold': '#f59e0b', 'silver': '#94a3b8', 'bronze': '#cd7f32', 'none': '#6b7280'} %}
    {% set icons = {'gold': 'ü•á', 'silver': 'ü•à', 'bronze': 'ü•â', 'none': '‚Äî'} %}
    {% set color = colors[level] %}
    {% set icon = icons[level] %}
    {% set score_pct = sc.score|default(0) %}

    <div style="background:linear-gradient(135deg,#1a1a2e,#16213e);border-radius:12px;padding:20px;margin-bottom:20px;border:1px solid {{ color }}44;">
        <h2 style="font-size:1.2rem;font-weight:700;margin-bottom:16px;">
            üìä {{ sc.scorecard_name|default("Scorecard")|e }}
        </h2>
        
        <div style="display:flex;align-items:center;gap:16px;margin-bottom:16px;">
            <div style="font-size:3rem;">{{ icon }}</div>
            <div>
                <div style="font-size:1.5rem;font-weight:800;color:{{ color }};text-transform:uppercase;letter-spacing:0.1em;">
                    {{ level|e }}
                </div>
                <div style="color:#94a3b8;font-size:0.85rem;">
                    {{ sc.passed_rules }}/{{ sc.total_rules }} rules passed ¬∑ {{ score_pct }}%
                </div>
            </div>
        </div>
        
        {{ m.score_bar(score_pct, 100) }}

        <div style="margin-top:16px;">
            <table class="sc-table">
                <thead>
                    <tr>
                        <th class="status">Status</th>
                        <th class="level">Level</th>
                        <th class="rule">Rule</th>
                        <th class="tags">Tags</th>
                        <th class="details">Details</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in sc.rules %}
                        {% set lvl = r.level|default('') %}
                        {% set lvl_icon = icons.get(lvl, '') %}
                        <tr>
                            <td class="status">
                                {% if r.status == "incomplete" %}
                                    <span title="Incomplete data">‚ö†Ô∏è</span>
                                {% elif r.passed %}
                                    ‚úÖ
                                {% else %}
                                    ‚ùå
                                {% endif %}
                            </td>
                            <td class="level">
                                {{ lvl_icon }} {{ lvl|e }}
                            </td>
                            <td class="rule">
                                <div class="rule-title">{{ r.title|default(r.name)|default('')|e }}</div>
                            </td>
                            <td class="tags">
                                {% if r.tags %}
                                    <div class="sc-tag-list">
                                        {% for tag in r.tags %}
                                            <span class="sc-tag">
                                                {{ tag|e }}
                                            </span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </td>
                            <td class="details">
                                {{ r.details|e }}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endif %}
