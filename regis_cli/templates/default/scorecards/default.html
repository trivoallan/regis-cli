{% import theme ~ "/macros.html" as m with context %}

{% set icons = {"bronze": "ü•â", "silver": "ü•à", "gold": "ü•á", "none": "‚≠ï"} %}

<article>
    <header>
        <h2 style="margin: 0;">{{ sc.scorecard_name|default("Scorecard")|e }}</h2>
    </header>

    {% if sc.display is defined and sc.display.widgets is defined %}
    <div class="grid">
        {% for w in sc.display.widgets %}
            <div>
                {% if w.icon %}<span style="font-size: 1.5rem;">{{ w.icon }}</span> {% endif %}
                <strong>{{ w.label|e }}</strong><br>
                <span style="font-size: 1.4rem; font-weight: bold;">
                    {%- if w.resolved_value is sameas true -%}‚úÖ
                    {%- elif w.resolved_value is sameas false -%}‚ùå
                    {%- elif w.resolved_value is none -%}<span style="opacity: 0.5;">N/A</span>
                    {%- else -%}{{ w.resolved_value }}
                    {%- endif -%}
                </span>
            </div>
        {% endfor %}
    </div>
    <hr>
    {% endif %}

    {% if sc.levels_summary %}
    <div class="grid">
        {% for level_name, stats in sc.levels_summary.items() %}
            {% set level_icon = icons.get(level_name, '') %}
            <div>
                <strong>{{ level_icon }} {{ level_name|capitalize }}</strong><br>
                {{ stats.passed }}/{{ stats.total }} passed ({{ stats.percentage }}%)
            </div>
        {% endfor %}
    </div>

    <hr>
    {% endif %}

    <div class="overflow-auto">
        <table class="striped">
            <thead>
                <tr>
                    <th>Status</th>
                    {% if sc.levels_summary %}<th>Level</th>{% endif %}
                    <th>Rule</th>
                    <th>Analyzers</th>
                </tr>
            </thead>
            <tbody>
                {% for r in sc.rules %}
                <tr>
                    <td>{{ m.bool_icon(r.passed) }}</td>
                    {% if sc.levels_summary %}<td><small>{{ r.level|capitalize }}</small></td>{% endif %}
                    <td>
                        <strong>{{ r.title|e }}</strong>
                        {% if r.tags %}
                        <div style="margin-top: 0.2rem;">
                            {% for tag in r.tags %}
                            {{ m.badge(tag) }}
                            {% endfor %}
                        </div>
                        {% endif %}
                        <div style="font-size: 0.8rem; opacity: 0.7; margin-top: 0.3rem;">{{ r.details|e }}</div>
                    </td>
                    <td>
                        {% for analyzer in r.analyzers %}
                        <small>{{ m.badge(analyzer, status="outline") }}</small>
                        {% endfor %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</article>
